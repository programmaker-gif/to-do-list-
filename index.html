<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© - Advanced To-Do List</title>
    
    <style>
        /* ========== CSS Ø§Ù„Ø£ØµÙ„ÙŠ + Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© + Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ØªØ£Ø®Ø±Ø© ========== */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            padding: 20px; 
            transition: direction 0.3s; 
            position: relative; 
        }
        
        /* ========== ØªØ£Ø«ÙŠØ± Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ù†Ø§Ø±ÙŠØ© / Fireworks Effect ========== */
        .fireworks { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1000; }
        .firework { position: absolute; width: 4px; height: 4px; background: #FFD700; border-radius: 50%; animation: explode 1.5s ease-out forwards; }
        @keyframes explode { 0% { transform: scale(0); opacity: 1; } 100% { transform: scale(0) translate(var(--dx), var(--dy)); opacity: 0; } }
        
        /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ø§Ù„Ø­Ø²ÙŠÙ† / Sad Emoji Effect */
        .sad-emoji { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 50px; z-index: 1001; animation: sadFloat 2s ease-out forwards; }
        @keyframes sadFloat { 0% { opacity: 1; transform: translate(-50%, -50%) scale(1); } 100% { opacity: 0; transform: translate(-50%, -50%) translateY(-100px) scale(0.5); } }
        
        .container { background: white; max-width: 800px; width: 100%; border-radius: 15px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2); padding: 30px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px; }
        h1 { color: #4A90E2; font-size: 28px; flex: 1; min-width: 200px; }
        #translateBtn { background: #9b59b6; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-size: 14px; cursor: pointer; transition: background 0.3s; font-weight: bold; }
        #translateBtn:hover { background: #8e44ad; }
        .input-section { display: flex; gap: 10px; margin-bottom: 25px; flex-wrap: wrap; }
        #taskInput { flex: 1; min-width: 200px; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px; transition: border-color 0.3s; }
        #taskInput:focus { outline: none; border-color: #4A90E2; }
        #taskTime { padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; transition: border-color 0.3s; min-width: 180px; }
        #taskTime:focus { outline: none; border-color: #4A90E2; }
        #addBtn { background: #4A90E2; color: white; border: none; padding: 12px 25px; border-radius: 8px; font-size: 16px; cursor: pointer; transition: background 0.3s, transform 0.1s; font-weight: bold; }
        #addBtn:hover { background: #357ABD; }
        #addBtn:active { transform: scale(0.98); }
        
        .section-title { color: #4A90E2; font-size: 20px; margin: 25px 0 15px 0; padding-bottom: 10px; border-bottom: 2px solid #e0e0e0; }
        
        /* ========== Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ØªØ£Ø®Ø±Ø© - ØªØµÙ…ÙŠÙ… Ù…Ù…ÙŠØ² / Overdue Tasks Styling ========== */
        #overdueList li { 
            background: #ffebee !important; /* Ø®Ù„ÙÙŠØ© Ø­Ù…Ø±Ø§Ø¡ ÙØ§ØªØ­Ø© */
            border-left: 4px solid #f44336; /* Ø®Ø· Ø£Ø­Ù…Ø± Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± */
            animation: pulse 2s infinite; /* ØªØ£Ø«ÙŠØ± Ù†Ø¨Ø¶ */
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(244, 67, 54, 0); }
            100% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0); }
        }
        #overdueList li .task-text { color: #d32f2f; font-weight: bold; }
        #overdueList li .task-time { color: #c62828; }
        
        #taskList, #completedList, #overdueList { list-style: none; margin-bottom: 20px; }
        #taskList li, #completedList li, #overdueList li { 
            background: #f8f9fa; 
            padding: 15px; 
            margin-bottom: 10px; 
            border-radius: 8px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            animation: fadeIn 0.4s ease-in; 
            transition: transform 0.2s; 
            gap: 10px; 
        }
        #taskList li:hover, #completedList li:hover, #overdueList li:hover { 
            transform: translateX(-5px); 
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1); 
        }
        html[dir="ltr"] #taskList li:hover, html[dir="ltr"] #completedList li:hover, html[dir="ltr"] #overdueList li:hover { 
            transform: translateX(5px); 
        }
        #completedList li { background: #D4EFDF; }
        #completedList li .task-text { text-decoration: line-through; color: #7f8c8d; }
        
        .task-content { flex: 1; display: flex; flex-direction: column; gap: 5px; }
        .task-text { color: #333; font-size: 16px; word-break: break-word; }
        .task-time { font-size: 12px; color: #7f8c8d; display: flex; align-items: center; gap: 5px; }
        .task-actions { display: flex; gap: 8px; }
        .complete-btn { background: #27ae60; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; font-size: 16px; transition: background 0.3s; font-weight: bold; }
        .complete-btn:hover { background: #229954; }
        .delete-btn { background: #e74c3c; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 14px; transition: background 0.3s; font-weight: bold; }
        .delete-btn:hover { background: #c0392b; }
        .move-to-overdue-btn { background: #ff9800; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; font-size: 14px; transition: background 0.3s; font-weight: bold; }
        .move-to-overdue-btn:hover { background: #f57c00; }
        .empty-message { text-align: center; color: #999; padding: 30px; font-size: 16px; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* ========== Responsive ========== */
        @media (max-width: 600px) { 
            .container { padding: 20px; } 
            h1 { font-size: 22px; } 
            #taskInput, #addBtn, #taskTime, #translateBtn { font-size: 14px; } 
            .input-section { flex-direction: column; } 
            #taskInput, #taskTime, #addBtn { width: 100%; min-width: auto; } 
            .task-actions { flex-direction: column; gap: 5px; } 
            .complete-btn, .delete-btn, .move-to-overdue-btn { padding: 6px 10px; font-size: 14px; } 
            .section-title { font-size: 18px; } 
            .task-text { font-size: 14px; } 
        }
        @media (min-width: 600px) and (max-width: 1024px) { 
            .container { padding: 35px; max-width: 700px; } 
            h1 { font-size: 26px; } 
            .section-title { font-size: 19px; } 
        }
        @media (min-width: 1024px) { 
            .container { max-width: 800px; padding: 40px; } 
            h1 { font-size: 30px; } 
            .section-title { font-size: 22px; } 
            .task-text { font-size: 17px; } 
        }
    </style>
</head>
<body>
    <div class="fireworks" id="fireworks"></div>
    <div class="container">
        <div class="header">
            <h1 id="mainTitle">ğŸ“ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h1>
            <button id="translateBtn">Translate to English</button>
        </div>
        <div class="input-section">
            <input type="text" id="taskInput" placeholder="Ø£Ø¶Ù Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©...">
            <input type="datetime-local" id="taskTime" title="ØªØ­Ø¯ÙŠØ¯ ÙˆÙ‚Øª Ø§Ù„ØªØ°ÙƒÙŠØ±">
            <button id="addBtn">Ø¥Ø¶Ø§ÙØ©</button>
        </div>
        
        <!-- ========== Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯: Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ØªØ£Ø®Ø±Ø© ========== -->
        <h3 class="section-title" id="overdueTitle">âš ï¸ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©</h3>
        <ul id="overdueList"></ul>
        
        <!-- ========== Ø§Ù„Ù…Ù‡Ø§Ù… Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ° (ØºÙŠØ± Ù…ØªØ£Ø®Ø±Ø©) ========== -->
        <h3 class="section-title" id="activeTitle">ğŸ“‹ Ù…Ù‡Ø§Ù… Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</h3>
        <ul id="taskList"></ul>
        
        <!-- ========== Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø© ========== -->
        <h3 class="section-title" id="completedTitle">âœ… Ù…Ù‡Ø§Ù… Ù…ÙƒØªÙ…Ù„Ø©</h3>
        <ul id="completedList"></ul>
    </div>

    <script>
        // ========== Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ==========
        const taskInput = document.getElementById('taskInput');
        const taskTime = document.getElementById('taskTime');
        const addBtn = document.getElementById('addBtn');
        const taskList = document.getElementById('taskList');
        const completedList = document.getElementById('completedList');
        const overdueList = document.getElementById('overdueList');
        const translateBtn = document.getElementById('translateBtn');
        const fireworks = document.getElementById('fireworks');
        const htmlElement = document.documentElement;
        let currentLang = 'ar';
        let reminderIntervals = [];

        // ========== Ø¹Ø¨Ø§Ø±Ø§Øª Ø§Ù„ØªØ­ÙÙŠØ² ==========
        const successMessages = ['Ø£Ø­Ø³Ù†Øª! ğŸ‰', 'Ø«Ø§Ø¨Ø± Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù…Ø§Ù…! ğŸ’ª', 'Ø¹Ù…Ù„ Ø±Ø§Ø¦Ø¹! ğŸŒŸ', 'Ø£Ù†Øª Ù…Ø°Ù‡Ù„! ğŸ”¥', 'Ù†Ø¬Ø§Ø­ Ø¢Ø®Ø±! ğŸ†'];
        const failureMessages = ['Ø³ØªØ¹ÙˆØ¶ ÙÙŠ Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©! ğŸ”„', 'Ø§Ù„Ù…Ù‡Ù… Ø¹Ø¯Ù… Ø§Ù„Ø§Ø³ØªØ³Ù„Ø§Ù…ØŒ ØªØ§Ø¨Ø¹! ğŸ‘', 'Ù„Ø§ ØªØ³ØªØ³Ù„Ù…! ğŸ˜Š', 'Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© Ø£ÙØ¶Ù„! ğŸ“ˆ', 'ØªØ¹Ù„Ù… Ù…Ù†Ù‡Ø§ ÙˆØªÙ‚Ø¯Ù…! ğŸŒ±'];

        // ========== Ù‚Ø§Ù…ÙˆØ³ Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù…Ø­Ø¯Ø« ==========
        const translations = {
            ar: { 
                mainTitle: 'ğŸ“ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©', 
                translateBtn: 'Translate to English', 
                taskInputPlaceholder: 'Ø£Ø¶Ù Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©...', 
                taskTimeTitle: 'ØªØ­Ø¯ÙŠØ¯ ÙˆÙ‚Øª Ø§Ù„ØªØ°ÙƒÙŠØ±', 
                addBtn: 'Ø¥Ø¶Ø§ÙØ©', 
                overdueTitle: 'âš ï¸ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©',
                activeTitle: 'ğŸ“‹ Ù…Ù‡Ø§Ù… Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°', 
                completedTitle: 'âœ… Ù…Ù‡Ø§Ù… Ù…ÙƒØªÙ…Ù„Ø©', 
                emptyOverdue: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ù…ØªØ£Ø®Ø±Ø©! ğŸ‘ Ù…Ù…ØªØ§Ø²!', 
                emptyActive: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°. Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†! ğŸ¯', 
                emptyCompleted: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ù…ÙƒØªÙ…Ù„Ø© Ø¨Ø¹Ø¯! ğŸ’ª', 
                alertEmpty: 'Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ù…Ù‡Ù…Ø© Ø£ÙˆÙ„Ø§Ù‹!', 
                completeBtn: 'Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ù…Ù‡Ù…Ø©', 
                deleteBtn: 'Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©', 
                moveToOverdueBtn: 'Ù†Ù‚Ù„ Ø¥Ù„Ù‰ Ù…ØªØ£Ø®Ø±', 
                confirmDelete: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ù…Ø©ØŸ',
                notificationTitle: 'â° ØªØ°ÙƒÙŠØ± Ø¨Ù…Ù‡Ù…Ø©', 
                alertReminder: 'â° ØªØ°ÙƒÙŠØ± Ø¨Ù…Ù‡Ù…Ø©:\n',
                moveConfirm: 'Ù‡Ù„ ØªØ±ÙŠØ¯ Ù†Ù‚Ù„ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¥Ù„Ù‰ Ù‚Ø³Ù… Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©ØŸ'
            },
            en: { 
                mainTitle: 'ğŸ“ Advanced To-Do List', 
                translateBtn: 'ØªØ±Ø¬Ù…Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', 
                taskInputPlaceholder: 'Add a new task...', 
                taskTimeTitle: 'Set reminder time', 
                addBtn: 'Add', 
                overdueTitle: 'âš ï¸ Overdue Tasks',
                activeTitle: 'ğŸ“‹ Active Tasks', 
                completedTitle: 'âœ… Completed Tasks', 
                emptyOverdue: 'No overdue tasks! ğŸ‘ Excellent!', 
                emptyActive: 'No active tasks. Start now! ğŸ¯', 
                emptyCompleted: 'No completed tasks yet! ğŸ’ª', 
                alertEmpty: 'Please write a task first!', 
                completeBtn: 'Complete task', 
                deleteBtn: 'Delete task', 
                moveToOverdueBtn: 'Move to Overdue', 
                confirmDelete: 'Are you sure you want to delete this task?',
                notificationTitle: 'â° Task Reminder', 
                alertReminder: 'â° Task Reminder:\n',
                moveConfirm: 'Do you want to move this task to the overdue section?'
            }
        };

        // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        if ('Notification' in window && Notification.permission === 'default') { 
            Notification.requestPermission(); 
        }
        
        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => { 
            loadLanguagePreference(); 
            loadTasks(); 
        });
        addBtn.addEventListener('click', addTask);
        taskInput.addEventListener('keypress', function(e) { 
            if (e.key === 'Enter') addTask(); 
        });
        translateBtn.addEventListener('click', toggleLanguage);

        // ========== Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ==========
        function toggleLanguage() { 
            currentLang = currentLang === 'ar' ? 'en' : 'ar'; 
            htmlElement.setAttribute('lang', currentLang); 
            htmlElement.setAttribute('dir', currentLang === 'en' ? 'ltr' : 'rtl'); 
            updateUITexts(); 
            localStorage.setItem('language', currentLang); 
        }
        
        function updateUITexts() { 
            const t = translations[currentLang]; 
            document.getElementById('mainTitle').textContent = t.mainTitle; 
            translateBtn.textContent = t.translateBtn; 
            taskInput.placeholder = t.taskInputPlaceholder; 
            taskTime.title = t.taskTimeTitle; 
            addBtn.textContent = t.addBtn; 
            document.getElementById('overdueTitle').textContent = t.overdueTitle;
            document.getElementById('activeTitle').textContent = t.activeTitle; 
            document.getElementById('completedTitle').textContent = t.completedTitle; 
            // ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
            document.querySelectorAll('.complete-btn').forEach(btn => btn.title = t.completeBtn);
            document.querySelectorAll('.delete-btn').forEach(btn => btn.title = t.deleteBtn);
            document.querySelectorAll('.move-to-overdue-btn').forEach(btn => btn.title = t.moveToOverdueBtn);
            checkEmptyLists(); 
        }
        
        function loadLanguagePreference() { 
            const savedLang = localStorage.getItem('language'); 
            if (savedLang && savedLang !== currentLang) { 
                currentLang = savedLang;
                htmlElement.setAttribute('lang', currentLang); 
                htmlElement.setAttribute('dir', currentLang === 'en' ? 'ltr' : 'rtl');
                updateUITexts(); 
            }
        }
        
        function getTasks() { return JSON.parse(localStorage.getItem('tasks')) || []; }
        function saveTasks(tasks) { localStorage.setItem('tasks', JSON.stringify(tasks)); }
        
        function addTask() { 
            const taskText = taskInput.value.trim(); 
            const reminderTime = taskTime.value; 
            if (!taskText) { 
                alert(translations[currentLang].alertEmpty); 
                return; 
            } 
            const task = { 
                id: Date.now(), 
                text: taskText, 
                completed: false, 
                reminderTime: reminderTime || null,
                createdAt: new Date().toISOString()
            }; 
            const tasks = getTasks(); 
            tasks.push(task); 
            saveTasks(tasks); 
            renderTasks(); 
            taskInput.value = ''; 
            taskTime.value = ''; 
            taskInput.focus(); 
            if (task.reminderTime && !task.completed) setupReminder(task); 
        }
        
        // ========== Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù‡Ø§Ù… Ù…Ø¹ Ø§Ù„ÙÙ„ØªØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ==========
        function renderTasks() { 
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
            overdueList.innerHTML = ''; 
            taskList.innerHTML = ''; 
            completedList.innerHTML = ''; 
            
            const tasks = getTasks(); 
            const now = new Date();
            
            // ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©
            const overdueTasks = tasks.filter(t => 
                !t.completed && 
                t.reminderTime && 
                new Date(t.reminderTime) < now
            ).sort((a, b) => new Date(a.reminderTime) - new Date(b.reminderTime));
            
            // Ø§Ù„Ù…Ù‡Ø§Ù… Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ° (ØºÙŠØ± Ù…ØªØ£Ø®Ø±Ø©)
            const activeTasks = tasks.filter(t => 
                !t.completed && 
                (!t.reminderTime || new Date(t.reminderTime) >= now)
            ).sort((a, b) => {
                if (!a.reminderTime) return 1;
                if (!b.reminderTime) return -1;
                return new Date(a.reminderTime) - new Date(b.reminderTime);
            });
            
            // Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©
            const completedTasks = tasks.filter(t => t.completed)
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)); // Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ±
            overdueTasks.forEach(task => createTaskElement(task, overdueList));
            activeTasks.forEach(task => createTaskElement(task, taskList));
            completedTasks.forEach(task => createTaskElement(task, completedList));
            
            checkEmptyLists(); 
        }
        
        function createTaskElement(task, targetList) { 
            const li = document.createElement('li'); 
            li.dataset.id = task.id; 
            const taskContent = document.createElement('div'); 
            taskContent.className = 'task-content'; 
            const span = document.createElement('span'); 
            span.className = 'task-text'; 
            span.textContent = task.text; 
            taskContent.appendChild(span); 
            
            if (task.reminderTime) { 
                const timeSpan = document.createElement('div'); 
                timeSpan.className = 'task-time'; 
                const reminderDate = new Date(task.reminderTime);
                const now = new Date();
                let timeText = `â° ${formatGregorianDate(reminderDate)}`;
                
                // Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ø§Ù…Ø© Ù…ØªØ£Ø®Ø±
                if (!task.completed && reminderDate < now) {
                    timeText += ' â°âš ï¸';
                }
                
                timeSpan.innerHTML = timeText;
                taskContent.appendChild(timeSpan); 
            } 
            
            const taskActions = document.createElement('div'); 
            taskActions.className = 'task-actions'; 
            
            const completeBtn = document.createElement('button'); 
            completeBtn.className = 'complete-btn'; 
            completeBtn.textContent = task.completed ? 'â†©ï¸' : 'âœ”ï¸'; 
            completeBtn.title = translations[currentLang].completeBtn; 
            completeBtn.onclick = () => toggleComplete(task.id); 
            
            const deleteBtn = document.createElement('button'); 
            deleteBtn.className = 'delete-btn'; 
            deleteBtn.textContent = 'âœ•'; 
            deleteBtn.title = translations[currentLang].deleteBtn; 
            deleteBtn.onclick = () => { 
                if (confirm(translations[currentLang].confirmDelete)) { 
                    if (!task.completed) showFailureMessage(); 
                    deleteTask(task.id); 
                } 
            }; 
            
            // Ø²Ø± Ø¬Ø¯ÙŠØ¯: Ù†Ù‚Ù„ Ø¥Ù„Ù‰ Ù…ØªØ£Ø®Ø±
            const moveToOverdueBtn = document.createElement('button');
            moveToOverdueBtn.className = 'move-to-overdue-btn';
            moveToOverdueBtn.textContent = 'â³';
            moveToOverdueBtn.title = translations[currentLang].moveToOverdueBtn;
            moveToOverdueBtn.onclick = () => moveTaskToOverdue(task.id);

            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ù‡Ù…Ø© ÙÙŠ Ù‚Ø³Ù… Ø§Ù„ØªÙ†ÙÙŠØ°
            if (targetList.id === 'taskList') {
                taskActions.appendChild(moveToOverdueBtn);
            }
            
            taskActions.appendChild(completeBtn); 
            taskActions.appendChild(deleteBtn); 
            li.appendChild(taskContent); 
            li.appendChild(taskActions); 
            targetList.appendChild(li); 
        }
        
        function formatGregorianDate(date) { 
            return date.toLocaleString('ar-EG', { 
                year: 'numeric', 
                month: '2-digit', 
                day: '2-digit', 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false
            }); 
        }
        
        function toggleComplete(id) { 
            const tasks = getTasks(); 
            const task = tasks.find(t => t.id === id); 
            if (task) { 
                task.completed = !task.completed; 
                saveTasks(tasks); 
                showSuccessMessage(); 
                renderTasks(); 
                clearReminder(id);
                if (task.completed) {
                    // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ°ÙƒÙŠØ± Ø¥Ø°Ø§ Ø£ÙØ¹ÙŠØ¯Øª Ø§Ù„Ù…Ù‡Ù…Ø© Ù„Ù„ØªÙ†ÙÙŠØ°
                    if (task.reminderTime) setupReminder(task);
                }
            } 
        }
        
        function deleteTask(id) { 
            const tasks = getTasks(); 
            const filteredTasks = tasks.filter(t => t.id !== id); 
            saveTasks(filteredTasks); 
            renderTasks(); 
            clearReminder(id); 
        }
        
        // Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©: Ù†Ù‚Ù„ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¥Ù„Ù‰ Ù‚Ø³Ù… Ø§Ù„Ù…ØªØ£Ø®Ø±Ø© (Ù…Ø¹Ø¯Ù„Ø©)
        function moveTaskToOverdue(id) {
            const tasks = getTasks();
            const task = tasks.find(t => t.id === id);
            if (task && !task.completed) {
                // Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ ØªØ­Ø¯ÙŠØ« reminderTime Ø¥Ù„Ù‰ ÙˆÙ‚Øª Ù…Ø¶Ù‰ (Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø© Ù…Ø¶Øª)
                task.reminderTime = task.reminderTime || new Date(Date.now() - 60000).toISOString();
                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„ÙˆÙ‚Øª ÙÙŠ Ø§Ù„Ù…Ø§Ø¶ÙŠ
                task.reminderTime = new Date(Date.now() - 60000).toISOString();
                if (confirm(translations[currentLang].moveConfirm)) {
                    saveTasks(tasks); // Ø¥Ø¹Ø§Ø¯Ø© Ø­ÙØ¸ Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                    renderTasks(); // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
                    clearReminder(id); // Ù…Ø³Ø­ Ø§Ù„ØªØ°ÙƒÙŠØ± Ø§Ù„Ù‚Ø¯ÙŠÙ…
                    showFailureMessage(); // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© ØªØ­ÙÙŠØ²ÙŠØ©
                }
            }
        }
        
        // ========== ÙØ­Øµ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„ÙØ§Ø±ØºØ© Ø§Ù„Ù…Ø­Ø¯Ø« ==========
        function checkEmptyLists() { 
            const t = translations[currentLang]; 
            
            if (overdueList.children.length === 0) {
                overdueList.innerHTML = `<li class="empty-message">${t.emptyOverdue}</li>`;
            }
            if (taskList.children.length === 0) {
                taskList.innerHTML = `<li class="empty-message">${t.emptyActive}</li>`;
            }
            if (completedList.children.length === 0) {
                completedList.innerHTML = `<li class="empty-message">${t.emptyCompleted}</li>`;
            }
        }
        
        // ========== Ø§Ù„ØªØ­ÙÙŠØ²Ø§Øª ÙˆØ§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª ==========
        function showSuccessMessage() { 
            const message = successMessages[Math.floor(Math.random() * successMessages.length)]; 
            alert(`ğŸ‰ ${message} ğŸ˜Š`); 
            createFireworks(); 
        }
        
        function showFailureMessage() { 
            const message = failureMessages[Math.floor(Math.random() * failureMessages.length)]; 
            alert(`ğŸ˜” ${message}`); 
            createSadEmoji(); 
        }
        
        function createFireworks() { 
            for (let i = 0; i < 30; i++) { 
                const firework = document.createElement('div'); 
                firework.className = 'firework'; 
                const angle = (Math.PI * 2 * i) / 30; 
                const distance = 100 + Math.random() * 200; 
                firework.style.left = '50%'; 
                firework.style.top = '50%'; 
                firework.style.setProperty('--dx', `${Math.cos(angle) * distance}px`); 
                firework.style.setProperty('--dy', `${Math.sin(angle) * distance}px`); 
                firework.style.background = `hsl(${Math.random() * 360}, 100%, 50%)`; 
                fireworks.appendChild(firework); 
                setTimeout(() => firework.remove(), 1500); 
            } 
        }
        
        function createSadEmoji() { 
            const emoji = document.createElement('div'); 
            emoji.className = 'sad-emoji'; 
            emoji.textContent = 'ğŸ˜”ğŸ’”'; 
            document.body.appendChild(emoji); 
            setTimeout(() => emoji.remove(), 2000); 
        }
        
        function setupReminder(task) { 
            if (task.reminderTime && !task.completed) { 
                const timeDiff = new Date(task.reminderTime).getTime() - Date.now(); 
                if (timeDiff > 0) { 
                    const intervalId = setTimeout(() => { 
                        if ('Notification' in window && Notification.permission === 'granted') { 
                            new Notification(translations[currentLang].notificationTitle, { 
                                body: task.text, 
                                icon: 'ğŸ””',
                                tag: `task-${task.id}`
                            }); 
                        } else { 
                            alert(translations[currentLang].alertReminder + task.text); 
                        } 
                        clearReminder(task.id);
                    }, timeDiff); 
                    reminderIntervals.push({ id: task.id, intervalId }); 
                } 
            } 
        }
        
        function clearReminder(id) { 
            const reminderIndex = reminderIntervals.findIndex(r => r.id === id); 
            if (reminderIndex !== -1) { 
                clearTimeout(reminderIntervals[reminderIndex].intervalId); 
                reminderIntervals.splice(reminderIndex, 1); 
            } 
        }
        
        function loadTasks() { 
            renderTasks(); 
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            reminderIntervals.forEach(reminder => clearTimeout(reminder.intervalId));
            reminderIntervals = [];
            getTasks().forEach(task => { 
                if (task.reminderTime && !task.completed) {
                    setupReminder(task);
                }
            }); 
        }
        
        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('beforeunload', () => {
            reminderIntervals.forEach(reminder => clearTimeout(reminder.intervalId));
        });
    </script>
</body>
</html>